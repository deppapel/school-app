<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Results</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f8f9fa; }
        table { width: 100%; border-collapse: collapse; background: white; margin-top: 20px; }
        th, td { border: 1px solid #dee2e6; padding: 12px; text-align: center; }
        th { background-color: #343a40; color: white; font-size: 0.9em; }
        .name-col { text-align: left; font-weight: bold; background-color: #f1f1f1; }
        .total-col { background-color: #e9ecef; font-weight: bold; }
        .grade-a { color: green; font-weight: bold; }
        .grade-e { color: red; }
        /* Added button styling */
        .btn-back { text-decoration: none; color: #007bff; font-weight: bold; margin-bottom: 20px; display: inline-block; }
        .btn { padding: 8px 15px; border-radius: 4px; border: none; cursor: pointer; text-decoration: none; font-size: 0.9em; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-secondary { background-color: #6c757d; color: white; }
    </style>
</head>
<body>

    <h2>Student Performance Matrix</h2>
    
    <div class="navigation-links">
        {% if current_user.role == 'ADMIN' %}
        <a href="/" class="btn-back">← Back to Admin Control Center</a>
        {% elif current_user.role == 'STUDENT' or current_user.role == 'GUEST' %}
        <a href="/dashboard" class="btn-back">← Back to My Student Portal</a>
        {% endif %}
    </div>

    <div class="filter-section" style="margin-bottom: 20px; padding: 15px; background: #f4f4f4; border-radius: 8px;">
    {% if current_user.role == 'ADMIN' %}
        <form action="/results" method="GET" style="display: flex; gap: 15px; align-items: end;">
            <div>
                <label>Academic Year:</label><br>
                <input type="number" name="year" value="{{ sel_year }}" class="form-control" style="width: 100px;">
            </div>

            <div>
                <label>Term:</label><br>
                <select name="term" class="form-control">
                    <option value="1" {% if sel_term == 1 %}selected{% endif %}>Term 1</option>
                    <option value="2" {% if sel_term == 2 %}selected{% endif %}>Term 2</option>
                    <option value="3" {% if sel_term == 3 %}selected{% endif %}>Term 3</option>
                </select>
            </div>

            <div>
                <label>Form:</label><br>
                <select name="form" class="form-control">
                    <option value="">All Forms</option>
                    <option value="1" {% if sel_form == 1 %}selected{% endif %}>Form 1</option>
                    <option value="2" {% if sel_form == 2 %}selected{% endif %}>Form 2</option>
                    <option value="3" {% if sel_form == 3 %}selected{% endif %}>Form 3</option>
                    <option value="4" {% if sel_form == 4 %}selected{% endif %}>Form 4</option>
                </select>
            </div>

            <button type="submit" class="btn btn-primary">Search Matrix</button>
            <a href="/results" class="btn btn-secondary">Reset to Current</a>
        </form>
    {% else %}
        <div style="color: #343a40; font-weight: bold;">
            <i class="fa fa-info-circle"></i> Viewing Results for Form {{ sel_form }} | Term {{ sel_term }} | Year {{ sel_year }}
        </div>
    {% endif %}
    </div>

    <table>
        <thead>
            <tr>
                <th rowspan="2">Rank</th>
                <th rowspan="2">Adm No</th>
                <th rowspan="2">Student Name</th>
                <th colspan="{{ compulsory_subjects|length }}">Compulsory Subjects</th>
                <th colspan="{{ arts_subjects|length }}">Arts Subjects</th>
                <th colspan="{{ applied_subjects|length }}">Applied Subjects</th>
                <th colspan="3">Summary</th>
            </tr>
            <tr>
                {% for sub in compulsory_subjects %} <th>{{ sub.subject_name }}</th> {% endfor %}
                {% for sub in arts_subjects %} <th>{{ sub.subject_name }}</th> {% endfor %}
                {% for sub in applied_subjects %} <th>{{ sub.subject_name }}</th> {% endfor %}
                
                <th>Total Points</th>
                <th>Total Marks</th>
                <th>Mean Grade</th>
            </tr>
        </thead>
        <tbody>
            {% for data in student_data %}
            <tr>
                <td>{{data.rank}}</td>
                <td>{{ data.student.adm_no }}</td>
                <td class="name-col">{{ data.student.first_name }} {{ data.student.second_name }}</td>

                {% for sub in compulsory_subjects %}
                <td>
                    {% if sub.id in data.results_dict %}
                        <strong>{{ data.results_dict[sub.id].marks }}</strong> <br>
                        <small>({{ data.results_dict[sub.id].grade }})</small>
                    {% else %}
                        -
                    {% endif %}
                </td>
                {% endfor %}

                {% for sub in arts_subjects %}
                <td>
                    {% if sub.id in data.results_dict %}
                        <strong>{{ data.results_dict[sub.id].marks }}</strong>
                        <small>({{ data.results_dict[sub.id].grade }})</small>
                    {% else %}
                        <span style="color: #ccc;">n/a</span>
                    {% endif %}
                </td>
                {% endfor %}

                {% for sub in applied_subjects %}
                <td>
                    {% if sub.id in data.results_dict %}
                        <strong>{{ data.results_dict[sub.id].marks }}</strong>
                        <small>({{ data.results_dict[sub.id].grade }})</small>
                    {% else %}
                        <span style="color: #ccc;">n/a</span>
                    {% endif %}
                </td>
                {% endfor %}

                <td class="total-col">{{ data.total_points }}</td>
                <td class="total-col">{{ data.total_marks}}</td>
                <td class="total-col">{{ data.final_grade }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</body>
</html>










